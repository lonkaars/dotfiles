var fs = require('fs');
var path = require('path');
var Color = require('color');
var dab = require('@s9a/dab');

module.exports = colors => {
	var getcolor = (color, lighten = 0, darken = 0) => Color(color).lighten(lighten).darken(darken).rgb().array().map(i => Math.floor(i));
	var tint = Color(colors.colors.color6).hsv().array();
	tint[0] = tint[0] / 360

	var config = {
		description: "Colorscheme generated by jswal",
		manifest_version: 2,
		name: "pywal",
		theme: {
			images: {
				theme_frame: "bg.png"
			},
			colors: {
				bookmark_text: getcolor(colors.special.foreground),
				frame: [255, 255, 255],
				ntp_background: getcolor(colors.special.background),
				ntp_text: getcolor(colors.special.background),
				tab_background_text: getcolor(colors.special.foreground, 0, 0.3),
				tab_background_text_inactive: getcolor(colors.special.foreground, 0, 0.3),
				tab_background_text_incognito: getcolor(colors.special.foreground, 0, 0.3),
				tab_background_text_incognito_inactive: getcolor(colors.special.foreground, 0, 0.3),
				tab_text: getcolor(colors.special.foreground),
				toolbar: getcolor(colors.special.background, 0.3),
				button_background: [255, 255, 255]
			},
			tints: {
				buttons: tint,
				frame_inactive: [-1, -1, -1],
				frame_incognito: [-1, -1, -1],
				frame_incognito_inactive: [-1, -1, -1]
			}
		},
		version: "2"
	}
	dab({
		from: colors.special.background,
		to: path.join(process.env.HOME, '/.cache/wal/chromium/bg.png'),
		shape: "200x200"
	})
	fs.writeFileSync(path.join(process.env.HOME, '/.cache/wal/chromium/manifest.json'), JSON.stringify(config, null, 4), 'utf-8');
}
